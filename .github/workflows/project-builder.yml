name: CI build and run
on: [push]
jobs:
  build-dependencies:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: git submodule update --init --recursive
      - run: make dependencies
  build:
    needs: build-dependencies
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: git submodule update --init --recursive
      - run: make dependencies
      - run: export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$(pwd)/lib
      - run: make
  test:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: git submodule update --init --recursive
      - run: sudo make dependencies
      - run: export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$(pwd)/lib
      - run: make
      - run: bin/warm_up
    